<!DOCTYPE html>
<html>
  <head>
    <!-- set charset -->
    <meta charset="UTF-8" />

    <!-- Viewport meta tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <!-- Author meta tag -->
    <meta name="author" content="Fahad Alamgir Dhruba" />

    

    <!-- tailwind cdn script -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- font awesome cdn -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

    <!-- title -->
    <title>Sign In</title>
  </head>
  <body>
    
    <div class="flex items-center justify-center h-screen dark:bg-gray-800">
        <button id="signInBtn" class="px-4 py-2 border flex gap-2 border-slate-200 dark:border-slate-700 rounded-lg text-slate-700 dark:text-slate-200 hover:border-slate-400 dark:hover:border-slate-500 hover:text-slate-900 dark:hover:text-slate-300 hover:shadow transition duration-150">
            <img class="w-6 h-6" src="https://www.svgrepo.com/show/475656/google-color.svg" loading="lazy" alt="google logo">
            <span id="res">Sign In with Google</span>
        </button>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAnalytics, logEvent, } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
      import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
      import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithRedirect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDMkHagk9VF0Ek3HQi1ewDO8j6Y1mvS94U",
        authDomain: "nexusbyte-9d357.firebaseapp.com",
        databaseURL: "https://nexusbyte-9d357-default-rtdb.firebaseio.com",
        projectId: "nexusbyte-9d357",
        storageBucket: "nexusbyte-9d357.appspot.com",
        messagingSenderId: "630594067402",
        appId: "1:630594067402:web:5eac3d5dd5686fb2aa4d33",
        measurementId: "G-8C9BLJ7QKB"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);

      const auth = getAuth();
      auth.languageCode = "it";

      const provider = new GoogleAuthProvider();

      //###############
      const database = getDatabase(app);

      function writeUserData(
        photoURL,
        email,
        creationTime,
        displayName,
        uid,
        phoneNumber,
        pool
      ) {
        const db = getDatabase();
        set(ref(db, "users/" + uid), {
          photoURL: photoURL,
          email: email,
          creationTime: creationTime,
          displayName: displayName,
          uid: uid,
          phoneNumber: phoneNumber,
          pool: pool,
        })
        .then(() => {
          // Data saved successfully!
          document.getElementById("res").innerHTML = "Signing you In..."

          // PrePage

         

          window.location.href = "../admin/developer/";
          
        })
        .catch((error) => {
          // The write failed...
        });
        
      }

      function signInInitiator() {
        signInWithPopup(auth, provider)
          .then((result) => {
            // This gives you a Google Access Token. You can use it to access the Google API.
            const credential = GoogleAuthProvider.credentialFromResult(result);
            const token = credential.accessToken;
            // The signed-in user info.
            const user = result.user;
            // IdP data available using getAdditionalUserInfo(result)
            //console.log(user);
            

            const poor = JSON.stringify(user);

            writeUserData(
              user.photoURL,
              user.email,
              user.metadata.creationTime,
              user.displayName,
              user.uid,
              user.phoneNumber,
              poor
            );
          })
          .catch((error) => {
            // Handle Errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            // The email of the user's account used.
            const email = error.customData.email;
            // The AuthCredential type that was used.
            const credential = GoogleAuthProvider.credentialFromError(error);
            // ...
          });
          
      }

      var signInBtn = document.getElementById("signInBtn");

      signInBtn.addEventListener("click", signInInitiator);
    </script>
  </body>
</html>
